(function(){sr.config({baseUrl:"js"});var b=$({}),k,p,c=$("#tar_rang")[0],x=$("#show_num"),q;require("task/initCanvas").post({width:128,height:72,point:10}).done(function(a){p=a}).require("task/initLrc").post({tar_rang:c}).done(function(a){q=a;$("#play").removeAttr("disabled")});var h=[],r=!1,y=function(a,b){if("pause"!=k){var d="source_jpg/";switch(String(a).length){case 1:d+="s_000"+ +a+".jpg";break;case 2:d+="s_00"+ +a+".jpg";break;case 3:d+="s_0"+ +a+".jpg";break;case 4:d+="s_"+ +a+".jpg"}require("uModule/loadImg").post(d).done(function(a){h.push(a);
b&&b()})}},z=function(a,g,d,c){k="playing";var e=a,f=function(){e<=g?y(e,function(){d&&d();b.trigger("cacheImgOneDone");e++;if(6>h.length)f();else{var a=function(){3>=h.length&&(b.unbind("transPointDatasDone",a),f())};b.bind("transPointDatasDone",a)}}):(r=!0,c&&c(),b.trigger("cacheImgOneEnd"))};f()},e=[],t=!1,u=new Worker("js/work/toPointDataWorker.js"),l=!0,f=0,m=function(){"pause"!=k&&l&&(l=!1,require("uModule/getImgData").post({img:h.shift(),cans:p,size:{w:128,h:72,rotate:15.2},imgDataWorker:u}).done(function(a){l=
!0;b.trigger("transPointDatasDone");e.push(a);f+=15.2;!h.length&&r&&(t=!0,u.terminate(),b.trigger("transPointDatasEnd"));if(h.length)if(6>e.length)m();else{var c=function(){3>e.length&&(b.unbind("transToCodeDone",c),m())};b.bind("transToCodeDone",c)}v()}))},n=!0,w=new Worker("js/work/toCodeWorker.js"),g=0,v=function(){"pause"!=k&&n&&(n=!1,g+=15.2,require("uModule/toCode").post({imgdata:e.shift(),lyc:q(),toCodeWorker:w}).done(function(a){n=!0;b.trigger("transToCodeDone");360<g&&(g-=360);f-=15.2;$(".vcode_container").empty().append(a).css("transform",
"rotate(-"+g+"deg)");x.text(c.value);c.value=parseInt(c.value)+1;!e.length&&t&&(w.terminate(),b.trigger("transToCodeEnd"));e.length&&v()}))};$("#play").click(function(a){g+=f;f=0;h=[];e=[];b.unbind("transPointDatasDone");b.unbind("transToCodeDone");z(c.value,2135,m);$("#pause").removeAttr("disabled");$("#play").attr("disabled","disabled");$("head").append('<style id="noselect">body{-webkit-user-select: none;user-select: none;}</style>');$(c).attr("disabled","disabled")});$("#pause").click(function(a){k=
"pause";$("#play").removeAttr("disabled");$("#pause").attr("disabled","disabled");$("#noselect").remove();$(c).removeAttr("disabled")});b.one("transToCodeEnd",function(){$("#noselect").remove()})})();